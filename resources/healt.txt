npm i express-status-monitor express-basic-auth

const monitor = require('express-status-monitor');
const basicAuth = require('express-basic-auth');

config

monitor: {
    route: process.env.MONITOR_ROUTE,
    user: process.env.MONITOR_USER,
    password: process.env.MONITOR_PASSWORD
}


MONITOR_ROUTE=/monitor
MONITOR_USER=admin
MONITOR_PASSWORD=1234



import monitor from 'express-status-monitor';
import basicAuth from 'express-basic-auth';
import config from '../config';


export function monitorMiddleware() {
    const statusMonitorMiddleware = monitor();

    const basicAuthMiddleware = config.monitor.user && config.monitor.password
        ? basicAuth({
            users: { [config.monitor.user]: config.monitor.password },
            challenge: true,
        })
        : (req, res, next) => next();

    function serveStatusPageMiddleware(req, res, next) {
        if (req.path === (config.monitor.route || '/status')) {
            basicAuthMiddleware(req, res, () => statusMonitorMiddleware.pageRoute(req, res, next));
        } else {
            next();
        }
    }

    return [statusMonitorMiddleware.middleware, serveStatusPageMiddleware];
}


API.js

import { monitorMiddleware } from '../middlewares/MonitorMiddlware';

app.use(monitorMiddleware());


npm install -g artillery

config:
  target: 'http://localhost
  phases:
    - duration: 60
      arrivalRate: 1000

scenarios:
  - name: "Register user with unique email"
    flow:
      - post:
          url: "/auth/login"
          json:
            email: "gevorg.gak4@gmail.com"
            password: "Ga123456"

artillery run loadtest.yml